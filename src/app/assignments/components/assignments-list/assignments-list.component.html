<h2>Liste des assignments :</h2>


<main *ngIf="dataSource">

   <div class="row" style="">

      <div class="col" style="display: flex;align-items: center;">
         <mat-form-field>
            <mat-label>Filter</mat-label>
            <input matInput (keyup)="applyFilter($event)" placeholder="Ex. ium" #searchInput>
         </mat-form-field>
      
      
         <mat-slide-toggle [(ngModel)]="renduFilter" (click)="onRenduFilter()">
            <container-element [ngSwitch]="renduFilter">
               <span *ngSwitchCase="true">Rendu</span>
               <span *ngSwitchCase="false">Non rendu</span>
               <span *ngSwitchDefault>Tous les assignments</span>
            </container-element>
      
      
         </mat-slide-toggle>

      </div>

      <div class="col" style="text-align:right">
         <button (click)="onRenduFilter(true); searchInput.value = ''" class="btn btn-primary">RÃ©initialiser les filtres</button>

      </div>


   </div>


   <table mat-table [dataSource]="dataSource" matSort (matSortChange)="announceSortChange($event)">

      <ng-container matColumnDef="nom">
         <th mat-header-cell *matHeaderCellDef mat-sort-header> Nom </th>
         <td mat-cell *matCellDef="let element" (click)="openAssignmentDetail(element)"> {{element?.nom}} </td>
      </ng-container>

      <ng-container matColumnDef="rendu">
         <th mat-header-cell *matHeaderCellDef mat-sort-header> Rendu </th>
         <td (click)="openAssignmentDetail(element)" [ngClass]="{'rendu':element?.rendu, 'nonRendu': !element?.rendu}" mat-cell *matCellDef="let element">
            {{element?.rendu?"Rendu le " :"Non Rendu"}} 
         
         </td>
      </ng-container>


      <ng-container matColumnDef="eleve">
         <th mat-header-cell *matHeaderCellDef mat-sort-header> Eleve </th>
         <td (click)="openAssignmentDetail(element)" mat-cell *matCellDef="let element"> {{element.eleve.name}} </td>
      </ng-container>

      <ng-container matColumnDef="note">
         <th mat-header-cell *matHeaderCellDef mat-sort-header> Note </th>
         <td (click)="openAssignmentDetail(element)" mat-cell *matCellDef="let element"> {{ ( element?.rendu && element?.note ) ? (element?.note)+"/20":"-"}} </td>
      </ng-container>

      <ng-container matColumnDef="actions">
         <th mat-header-cell *matHeaderCellDef > Actions </th>
         <td mat-cell *matCellDef="let element" class="cell-actions">
            
            <ng-container *ngIf="user?.roles?.[0]?.name === 'ADMIN'; else blockDetailsLink">
               <button (click)="onDeleteAssignment(element)" class="btn btn-danger">Supprimer</button>
            </ng-container>

            <ng-template #blockDetailsLink>
               <a [routerLink]="['/assignment', element._id]"> <button  class="btn btn-success">Consulter</button> </a>
            </ng-template>
            </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>

      <tr mat-row *matRowDef="let row; columns: displayedColumns;"> </tr>

   </table>


   <mat-paginator (page)="pageChange($event)" [showFirstLastButtons]="true" [pageIndex]="this.page"
      [length]="this.totalDocs" [pageSizeOptions]="[15,20,30]" aria-label="Select page">
   </mat-paginator>

</main>